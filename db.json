{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-fluid/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/css/gitalk.css","path":"css/gitalk.css","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/avatar.png","path":"img/avatar.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/default.png","path":"img/default.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/favicon.png","path":"img/favicon.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/loading.gif","path":"img/loading.gif","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/police_beian.png","path":"img/police_beian.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/boot.js","path":"js/boot.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/events.js","path":"js/events.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/color-schema.js","path":"js/color-schema.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/img-lazyload.js","path":"js/img-lazyload.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/leancloud.js","path":"js/leancloud.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/plugins.js","path":"js/plugins.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/local-search.js","path":"js/local-search.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/xml/local-search.xml","path":"xml/local-search.xml","modified":1,"renderable":1},{"_id":"source/img/2022.01.13.1.png","path":"img/2022.01.13.1.png","modified":1,"renderable":0},{"_id":"source/img/2022.01.14.1.png","path":"img/2022.01.14.1.png","modified":1,"renderable":0},{"_id":"source/img/2022.01.14.2.png","path":"img/2022.01.14.2.png","modified":1,"renderable":0},{"_id":"source/img/2022.01.14.3.png","path":"img/2022.01.14.3.png","modified":1,"renderable":0},{"_id":"source/img/avatar.png","path":"img/avatar.png","modified":1,"renderable":0},{"_id":"source/img/default.jpg","path":"img/default.jpg","modified":1,"renderable":0},{"_id":"source/img/default.png","path":"img/default.png","modified":1,"renderable":0},{"_id":"source/img/favicon.png","path":"img/favicon.png","modified":1,"renderable":0},{"_id":"source/img/miaomiao.JPG","path":"img/miaomiao.JPG","modified":1,"renderable":0}],"Cache":[{"_id":"source/.DS_Store","hash":"99e402eacc440d8fc3e52a45c0eec1ee2b4f170e","modified":1642145878376},{"_id":"source/_posts/2022-01-14-2.md","hash":"ba650dca32725d3b418fea4999ffa3a1c774a8ef","modified":1642139852234},{"_id":"source/_posts/2022-01-14-3.md","hash":"1ebe456962d86088cd66d4df1282435f90a217b3","modified":1642139852266},{"_id":"source/about/index.md","hash":"b9ec0d6de292e3a07e6239008af4bf180d619dfa","modified":1642146253088},{"_id":"source/img/.DS_Store","hash":"629104e4beb8fa1a51b7c04f8ea5f0b5a9c7cb94","modified":1642145878375},{"_id":"source/_posts/2022-01-13-1.md","hash":"bc5cf6ef9f06c1b7dd0ce6468771528764cf1def","modified":1642127879106},{"_id":"source/_posts/2022-01-14-1.md","hash":"7bdbd33b7d2651171c33614e715023e92d79eb87","modified":1642127845332},{"_id":"source/img/2022.01.13.1.png","hash":"ca711c0f3099cc42172cb5b0e72a322d7f6d3eae","modified":1642127868931},{"_id":"source/img/2022.01.14.2.png","hash":"1b573758b98a28cb7b9f276413152c4ff826ea38","modified":1642139852235},{"_id":"source/img/2022.01.14.3.png","hash":"038e34cdfb8ee37c9b12ce22a931c3f54b765756","modified":1642139852266},{"_id":"source/img/2022.01.14.1.png","hash":"457563e3b79c3c5f22d065b8bb966b58ed413e77","modified":1642128416031},{"_id":"source/img/favicon.png","hash":"2cb72e89362cebba4e84617c185379965772b594","modified":1642128431515},{"_id":"source/img/avatar.png","hash":"7ba2b5e584fdcff16ac464c31012e0717df0e154","modified":1642143447663},{"_id":"source/img/miaomiao.JPG","hash":"60b94fd56002070d8be535b35adfef67f0b4be6c","modified":1642146142925},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_category/category.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_tag/tag.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1642088123732},{"_id":"node_modules/hexo-theme-fluid/.eslintrc","hash":"4bc2b19ce2b8c4d242f97d4ccf2d741e68ab0097","modified":1642088123732},{"_id":"node_modules/hexo-theme-fluid/.editorconfig","hash":"33218fbd623feb43edf5f99f15965392cecc44a6","modified":1642088123732},{"_id":"node_modules/hexo-theme-fluid/README.md","hash":"03cfa8e5f149514b57ef80dcb84eb7fea261370d","modified":1642088123734},{"_id":"node_modules/hexo-theme-fluid/LICENSE","hash":"df5b54be535593d5442cebafbea34eb9bd69b987","modified":1642088123733},{"_id":"node_modules/hexo-theme-fluid/package.json","hash":"b32a2f76b01c44d4dfefa66a05e77a99d4ea5299","modified":1642088123742},{"_id":"node_modules/hexo-theme-fluid/README_en.md","hash":"ca8fd19a4948de1f253616a62c0e8a7d81f692f5","modified":1642088123734},{"_id":"node_modules/hexo-theme-fluid/languages/de.yml","hash":"13a6a799415fc2f6f69ebd1a399fb44426a5d641","modified":1642088123734},{"_id":"node_modules/hexo-theme-fluid/_config.yml","hash":"8a7f1534c228538e2ab56249d5a65829650170ed","modified":1642088123734},{"_id":"node_modules/hexo-theme-fluid/languages/en.yml","hash":"a85dcc5cc21f9cab50df31e5001b8818ee62d1e2","modified":1642088123734},{"_id":"node_modules/hexo-theme-fluid/languages/eo.yml","hash":"a0c7984495d4f2d33b64adfa33adebbf768a5ac3","modified":1642088123735},{"_id":"node_modules/hexo-theme-fluid/languages/ja.yml","hash":"91020031a847c0361a6fd7ab990c7be4bf17529b","modified":1642088123735},{"_id":"node_modules/hexo-theme-fluid/languages/zh-TW.yml","hash":"1a6d415446da11dee5c5f400e7d67544fbe743ea","modified":1642088123735},{"_id":"node_modules/hexo-theme-fluid/layout/404.ejs","hash":"689d9f4efd2a7f5edfd9b24561a7ade69d46617c","modified":1642088123735},{"_id":"node_modules/hexo-theme-fluid/languages/zh-CN.yml","hash":"21307b4137c3d9b04bb58243747e75af0abc5a71","modified":1642088123735},{"_id":"node_modules/hexo-theme-fluid/layout/about.ejs","hash":"ad6fed7b646d3ca961db83db0fbe020e3a5d42ad","modified":1642088123740},{"_id":"node_modules/hexo-theme-fluid/layout/archive.ejs","hash":"472d0813ca5b88000a7bc6039f33b7e27b5a3216","modified":1642088123740},{"_id":"node_modules/hexo-theme-fluid/layout/categories.ejs","hash":"20c2a195a109d2a263b5fa6e79cbcc62932508ad","modified":1642088123740},{"_id":"node_modules/hexo-theme-fluid/layout/category.ejs","hash":"58291dfec65c36889dfce0ddc603540b67e4c598","modified":1642088123741},{"_id":"node_modules/hexo-theme-fluid/layout/index.ejs","hash":"f3ae4395e751c4a02d5895e07856b1e8edfdda08","modified":1642088123741},{"_id":"node_modules/hexo-theme-fluid/layout/links.ejs","hash":"2a7b49f0f9aecf07550b5a0b99242aab5654cf2b","modified":1642088123741},{"_id":"node_modules/hexo-theme-fluid/layout/layout.ejs","hash":"7f566edf750241e62d7c54abfbb0c504fdab850a","modified":1642088123741},{"_id":"node_modules/hexo-theme-fluid/layout/page.ejs","hash":"1014b901d396f4fc445cb1ffc938d5380d894d71","modified":1642088123741},{"_id":"node_modules/hexo-theme-fluid/layout/tag.ejs","hash":"0ad89eb7c92a822980fa9a85285e6d94ad845d1d","modified":1642088123741},{"_id":"node_modules/hexo-theme-fluid/layout/post.ejs","hash":"79e3679a7069351a6172c281b9d09f59d7580484","modified":1642088123741},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/bug_report.md","hash":"16d33eb89ecf90f4046720fde5395d972c7ba1fd","modified":1642088123732},{"_id":"node_modules/hexo-theme-fluid/layout/tags.ejs","hash":"1d06af34b6cf1d8a20d2eb565e309326ceba309f","modified":1642088123741},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/bug_report_zh.md","hash":"af977ed0792508bb0766ea8afe82d34ef1e8fb3c","modified":1642088123733},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/feature_request.md","hash":"c134dd57ffd269b93402ccfffe7dbe0f0b583bec","modified":1642088123733},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/feature_request_zh.md","hash":"ed08574b196447376dd74411cca664ac9227a5d4","modified":1642088123733},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/question.md","hash":"ab5eab9e3ff889c4ba7fd82846e7f5b7ae15bebc","modified":1642088123733},{"_id":"node_modules/hexo-theme-fluid/.github/ISSUE_TEMPLATE/question_zh.md","hash":"e24b470f7aa8044499a4f5e39634e5dc43899011","modified":1642088123733},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/archive-list.ejs","hash":"53a4f6029373a40394a87aba9284696a71610f90","modified":1642088123736},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/beian.ejs","hash":"58b4bbe36386de4305a8da5ffd7d56802df23049","modified":1642088123736},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/css.ejs","hash":"c363829a4b80f74fc1c565e41f6dab41c95006ea","modified":1642088123738},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/footer.ejs","hash":"a62278c38a310da495d96c39abacacef266945cb","modified":1642088123738},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/paginator.ejs","hash":"0f38a2c238169edcb63fc46c23bfc529ff3859b7","modified":1642088123738},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/nav.ejs","hash":"e71b3c4aa263163597d31b1f91e5a1a877084cfd","modified":1642088123738},{"_id":"node_modules/hexo-theme-fluid/.github/workflows/limit.yaml","hash":"f8bd2edeb4424ee7a055b31583445d5d5dff91a4","modified":1642088123733},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/head.ejs","hash":"f7f3494ed001e8cdcdc3e8a1d2cd1195cff2ded5","modified":1642088123738},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/post-meta.ejs","hash":"32a17edadeed40da6db21d2d8031bd47d2fc9bf4","modified":1642088123739},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/scripts.ejs","hash":"0ee838b6fcd895d21a29d9d67dbb99b752d623d1","modified":1642088123740},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/search.ejs","hash":"cdd7919fa01f6ef7ccc09938d662ff3d77f5d999","modified":1642088123740},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/statistics.ejs","hash":"920bc618d357d48d2b96f8758f6ae8f9488fc4d8","modified":1642088123740},{"_id":"node_modules/hexo-theme-fluid/scripts/events/index.js","hash":"44faef3e77ab08b91e4c5c6f1cd9087a9faff443","modified":1642088123742},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/toc.ejs","hash":"3d2fb5552f373e5a0c56bc356702d807bcbcb411","modified":1642088123740},{"_id":"node_modules/hexo-theme-fluid/scripts/filters/post-filter.js","hash":"6c37e9f1ac1d6d00b3c32794e02e244dba942cd9","modified":1642088123743},{"_id":"node_modules/hexo-theme-fluid/scripts/filters/locals.js","hash":"58d0fec976f6b1d35e7ea03edc45414088acf05c","modified":1642088123743},{"_id":"node_modules/hexo-theme-fluid/scripts/generators/pages.js","hash":"d9971f15fbb6b775e3d31a1b9b45011959395010","modified":1642088123743},{"_id":"node_modules/hexo-theme-fluid/scripts/generators/local-search.js","hash":"fc2c50405b771b06b7f6cfc4e9de97b992691555","modified":1642088123743},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/export-config.js","hash":"cde964c8cd3217268a231de5e018a62c53c2e047","modified":1642088123743},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/page.js","hash":"4607607445233b3029ef20ed5e91de0da0a7f9c5","modified":1642088123743},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/url.js","hash":"2a6a8288176d0e0f6ec008056bf2745a86e8943e","modified":1642088123743},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/utils.js","hash":"3aa5b4ea879cd34d3a32468d88da18d72cbcc8e0","modified":1642088123743},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/wordcount.js","hash":"b917b893b1777e6ffcb53188f9f5644510e5f20d","modified":1642088123744},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/button.js","hash":"3eb43a8cdea0a64576ad6b31b4df6c2bf5698d4c","modified":1642088123744},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/group-image.js","hash":"4aeebb797026f1df25646a5d69f7fde79b1bcd26","modified":1642088123744},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/checkbox.js","hash":"63468f7875c09d9557fe8315afc97175745d9087","modified":1642088123744},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/label.js","hash":"f05a6d32cca79535b22907dc03edb9d3fa2d8176","modified":1642088123744},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/mermaid.js","hash":"75160561e1ef3603b6d2ad2938464ab1cb77fd38","modified":1642088123745},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/object.js","hash":"649457796374c79e49a19bd541e4ad8e78fe8995","modified":1642088123745},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/note.js","hash":"f52f3a005b41f48b4da274ac64710177c8d4502f","modified":1642088123745},{"_id":"node_modules/hexo-theme-fluid/source/css/main.styl","hash":"d5a8a59c8d1fd17d699a951e59c4ce9ae44c419d","modified":1642088123749},{"_id":"node_modules/hexo-theme-fluid/source/css/gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":1642088123749},{"_id":"node_modules/hexo-theme-fluid/source/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1642088123749},{"_id":"node_modules/hexo-theme-fluid/source/img/favicon.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1642088123750},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/compare-versions.js","hash":"dbbc928c914fc2bd242cd66aa0c45971aec13a5d","modified":1642088123745},{"_id":"node_modules/hexo-theme-fluid/source/img/default.png","hash":"7bb2b8ee07db305bcadee2985b81b942027ae940","modified":1642088123750},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/url-join.js","hash":"718aab5e7b2059a06b093ca738de420d9afa44ba","modified":1642088123745},{"_id":"node_modules/hexo-theme-fluid/source/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1642088123750},{"_id":"node_modules/hexo-theme-fluid/source/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1642088123750},{"_id":"node_modules/hexo-theme-fluid/source/js/events.js","hash":"4b9d2676c9544db9cc40a8c7d18456792299ba86","modified":1642088123750},{"_id":"node_modules/hexo-theme-fluid/source/js/boot.js","hash":"3de344ee619da989f6dccf7c2ae459fe91075983","modified":1642088123750},{"_id":"node_modules/hexo-theme-fluid/source/js/color-schema.js","hash":"f1fdd512f3ef92ff5db4a49f5a3143d5ddea9858","modified":1642088123750},{"_id":"node_modules/hexo-theme-fluid/source/js/img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":1642088123751},{"_id":"node_modules/hexo-theme-fluid/source/js/leancloud.js","hash":"53987b7a668ea0623370eb83ed5311766221b557","modified":1642088123751},{"_id":"node_modules/hexo-theme-fluid/source/js/plugins.js","hash":"d058f30bd09b28769c4d8313428ff23dfc8d52dd","modified":1642088123751},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/changyan.ejs","hash":"c9b2d68ed3d375f1953e7007307d2a3f75ed6249","modified":1642088123736},{"_id":"node_modules/hexo-theme-fluid/source/xml/local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":1642088123751},{"_id":"node_modules/hexo-theme-fluid/source/js/utils.js","hash":"4a43f2700e91937650bef511fd438825b001c4c6","modified":1642088123751},{"_id":"node_modules/hexo-theme-fluid/source/js/local-search.js","hash":"633f0142c657805359b0197f287e12ae4bcde731","modified":1642088123751},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/disqus.ejs","hash":"aab4a4d24c55231a37db308ae94414319cecdd9b","modified":1642088123736},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/cusdis.ejs","hash":"5f9dc012be27040bbe874d0c093c0d53958cc987","modified":1642088123736},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/gitalk.ejs","hash":"843bc141a4545eb20d1c92fb63c85d459b4271ec","modified":1642088123737},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/livere.ejs","hash":"2264758fed57542a7389c7aa9f00f1aefa17eb87","modified":1642088123737},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/remark42.ejs","hash":"d4e9532feeb02aed61bd15eda536b5b631454dac","modified":1642088123737},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/utterances.ejs","hash":"e1ed6530dfd7310f91060a75766a93ac3c39be3a","modified":1642088123737},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/twikoo.ejs","hash":"1af53bc0be642610a3a4d4e7c05287854a821508","modified":1642088123737},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/valine.ejs","hash":"4052ab2a8f78efa92f0fe17abe8f66135943390a","modified":1642088123737},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/comments/waline.ejs","hash":"21e00443054802e893aac1f668b69d5bb4b39b3a","modified":1642088123737},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/analytics.ejs","hash":"557077a8825fffc0a2c7fe2b29f319287950244f","modified":1642088123738},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/mermaid.ejs","hash":"10ed1f9a611449d37736e17c4e251127b38b3772","modified":1642088123739},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/math.ejs","hash":"df6941bd3b860180d01fd39ee859ed2d42f4d1f0","modified":1642088123739},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/compatible-configs.js","hash":"b5fd5a2d9c463eb59318af0f47c591c485b6ad27","modified":1642088123742},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/footnote.js","hash":"3b2abc5f5e3b681874637e98e047dc4969eb1983","modified":1642088123742},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/hello.js","hash":"28e186c32576eb3d5d923273471a001c47fe8071","modified":1642088123742},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/highlight.js","hash":"fd5fcb6a61ad865197a778eeae889b80484227dd","modified":1642088123742},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/lazyload.js","hash":"9ba0d4bc224e22af8a5a48d6ff13e5a0fcfee2a4","modified":1642088123742},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/merge-configs.js","hash":"c1db1a4f9eca6e36b660530641e3a4fb6a30c8d8","modified":1642088123742},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/nprogress.ejs","hash":"4c2d39ce816b8a6dcd6b53113c8695f8bd650a23","modified":1642088123739},{"_id":"node_modules/hexo-theme-fluid/layout/_partial/plugins/typed.ejs","hash":"e8e01c5db46b383748855452aecd70fcda99f598","modified":1642088123739},{"_id":"node_modules/hexo-theme-fluid/source/css/_functions/base.styl","hash":"2e46f3f4e2c9fe34c1ff1c598738fc7349ae8188","modified":1642088123745},{"_id":"node_modules/hexo-theme-fluid/source/css/_mixins/base.styl","hash":"542e306ee9494e8a78e44d6d7d409605d94caeb3","modified":1642088123745},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/pages.styl","hash":"b8e887bc7fb3b765a1f8ec9448eff8603a41984f","modified":1642088123749},{"_id":"node_modules/hexo-theme-fluid/source/css/_variables/base.styl","hash":"08b455b848b21d57e0563b87071c4bae2b63bafe","modified":1642088123749},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_about/about.styl","hash":"97fe42516ea531fdad771489b68aa8b2a7f6ae46","modified":1642088123746},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_archive/archive.styl","hash":"6e6f22b664199772370b59ce1678b0c148b5849f","modified":1642088123746},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/base.styl","hash":"c2d8bfd04bf0734b387c049402b46a06a05fc582","modified":1642088123747},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/color-schema.styl","hash":"80098e8354069631bde8edcd1181a53091a92949","modified":1642088123747},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/inline.styl","hash":"d547ab0b91f84eb0acd0bc0c5d716ce17c30361a","modified":1642088123747},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/keyframes.styl","hash":"94065ea50f5bef7566d184f2422f6ac20866ba22","modified":1642088123747},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/rewrite.styl","hash":"a2993f23701de9a83e3f428300e62c5c52b4ff4b","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_category/categories.styl","hash":"1ab7db37c2f7dc7ccdb994dcb41c16a4c8920397","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_index/index.styl","hash":"616c1f7147078c3d532dd1cfd2af09c0c3a816f0","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_links/links.styl","hash":"7e32a3268accf3d524209c213e15e2d5d5e2e1a6","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/tag_plugin.styl","hash":"b89b96c8a6a433a6f372b42710554b05cab85a24","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/post.styl","hash":"5e86487de0f16c30ca3e16460ab94b57620e31c5","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_tag/tags.styl","hash":"65bfc01c76abc927fa1a23bf2422892b0d566c3f","modified":1642088123748},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/banner.styl","hash":"30f8fab95a5214d79df0ccc02b937df8bd885676","modified":1642088123746},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/board.styl","hash":"32d90bcc8bf2fd5d8d78e86a567973d4b69bcfa1","modified":1642088123746},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/copy-btn.styl","hash":"9f932ca3f9625c13aa5353f58319881e62c0c653","modified":1642088123746},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/header.styl","hash":"d8011325756eb6e4ce619b3e7b4d6d80c2de8a57","modified":1642088123746},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/footer.styl","hash":"0ce7552dc4993926426019398d73e817cfd841a1","modified":1642088123746},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/footnote.styl","hash":"ae9289cc89649af2042907f8a003303b987f3404","modified":1642088123746},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/qrcode.styl","hash":"78704a94c0436097abfb0e0a57abeb3429c749b7","modified":1642088123747},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/scroll-btn.styl","hash":"55e10a6965462f8f62f85e75fd5e143af02a4b44","modified":1642088123747},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/search.styl","hash":"10f7e91a91e681fb9fe46f9df7707b9ef78707c8","modified":1642088123747},{"_id":"source/img/default.jpg","hash":"5953feea3be832aaac1588f0800736a0958ffa99","modified":1642126470754},{"_id":"source/img/default.png","hash":"33b0fca4765db1e7c04c8c90bc63efef3fdc0494","modified":1642141992067},{"_id":"public/atom.xml","hash":"35cadc85c96009f9e03bc6e632dfc7e7e39b3dca","modified":1642146260369},{"_id":"public/local-search.xml","hash":"638ca9fac365e2a835e9bacb10ff7d7e12722089","modified":1642146260369},{"_id":"public/about/index.html","hash":"f78732b48a8c4a27dd13bfeea328b82261762de2","modified":1642146260369},{"_id":"public/archives/index.html","hash":"974d9593d4a138b0addf203168c3b2427730751d","modified":1642146260369},{"_id":"public/archives/2022/index.html","hash":"dfdf7c9bab692224ef5fddba804a747ee3c5d282","modified":1642146260369},{"_id":"public/archives/2022/01/index.html","hash":"12e8c4b68f663ed23797b0de04bcc6b0417b2d4f","modified":1642146260369},{"_id":"public/categories/React/index.html","hash":"dfa96324388ee2abb2b85e8ecf02b1d2e0c9268e","modified":1642146260369},{"_id":"public/categories/JS/index.html","hash":"248bfbcf3bbeb16b23603dc76abad70fdbcdbc22","modified":1642146260369},{"_id":"public/index.html","hash":"2771f8d102e92b0bee99f2cf2cbedeb24a23595f","modified":1642146260369},{"_id":"public/tags/HooK/index.html","hash":"21ec918e1a204c1f94c5ee2aab467e4030f6bf4b","modified":1642146260369},{"_id":"public/tags/React/index.html","hash":"c82406a38093742e0bc437514e50eb375681a77b","modified":1642146260369},{"_id":"public/tags/map/index.html","hash":"68047e19b9a8076cf99e8611bfa7d11e47d377a0","modified":1642146260369},{"_id":"public/404.html","hash":"b1d845d1fc45f4d1523af4b54d7e133b3bacf29b","modified":1642146260369},{"_id":"public/tags/index.html","hash":"8a5e08e0070317bf5d01ad50f90a9f1f1b41de83","modified":1642146260369},{"_id":"public/categories/index.html","hash":"c817ebe6498ba87441c0b39ebb699f53b5942834","modified":1642146260369},{"_id":"public/links/index.html","hash":"ea4ed26f132fb482a4b70d5bedda10344ba2e7bb","modified":1642146260369},{"_id":"public/2022/01/14/3/index.html","hash":"754fcde03af7aa5398d83adc7afe9844b7fb62cd","modified":1642146260369},{"_id":"public/2022/01/14/2/index.html","hash":"73a797c3c0eed329f325abb058a1120ad1e15bb9","modified":1642146260369},{"_id":"public/2022/01/14/1/index.html","hash":"99875ee278d3bf7e48906d409f4e39a4ff9318b6","modified":1642146260369},{"_id":"public/2022/01/13/1/index.html","hash":"6dbfea249cb9826daa1c0c660a527cd0e8bcfa40","modified":1642146260369},{"_id":"public/img/favicon.png","hash":"2cb72e89362cebba4e84617c185379965772b594","modified":1642146260369},{"_id":"public/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1642146260369},{"_id":"public/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1642146260369},{"_id":"public/xml/local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":1642146260369},{"_id":"public/img/2022.01.13.1.png","hash":"ca711c0f3099cc42172cb5b0e72a322d7f6d3eae","modified":1642146260369},{"_id":"public/img/2022.01.14.1.png","hash":"457563e3b79c3c5f22d065b8bb966b58ed413e77","modified":1642146260369},{"_id":"public/img/2022.01.14.2.png","hash":"1b573758b98a28cb7b9f276413152c4ff826ea38","modified":1642146260369},{"_id":"public/img/2022.01.14.3.png","hash":"038e34cdfb8ee37c9b12ce22a931c3f54b765756","modified":1642146260369},{"_id":"public/img/avatar.png","hash":"7ba2b5e584fdcff16ac464c31012e0717df0e154","modified":1642146260369},{"_id":"public/img/miaomiao.JPG","hash":"60b94fd56002070d8be535b35adfef67f0b4be6c","modified":1642146260369},{"_id":"public/css/gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":1642146260369},{"_id":"public/js/boot.js","hash":"3de344ee619da989f6dccf7c2ae459fe91075983","modified":1642146260369},{"_id":"public/js/events.js","hash":"4b9d2676c9544db9cc40a8c7d18456792299ba86","modified":1642146260369},{"_id":"public/js/color-schema.js","hash":"f1fdd512f3ef92ff5db4a49f5a3143d5ddea9858","modified":1642146260369},{"_id":"public/js/plugins.js","hash":"d058f30bd09b28769c4d8313428ff23dfc8d52dd","modified":1642146260369},{"_id":"public/js/local-search.js","hash":"633f0142c657805359b0197f287e12ae4bcde731","modified":1642146260369},{"_id":"public/js/utils.js","hash":"4a43f2700e91937650bef511fd438825b001c4c6","modified":1642146260369},{"_id":"public/js/img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":1642146260369},{"_id":"public/js/leancloud.js","hash":"53987b7a668ea0623370eb83ed5311766221b557","modified":1642146260369},{"_id":"public/css/main.css","hash":"63bc59b8ca4b03afa2b93883143c349d461b1052","modified":1642146260369},{"_id":"public/img/default.jpg","hash":"5953feea3be832aaac1588f0800736a0958ffa99","modified":1642146260369},{"_id":"public/img/default.png","hash":"33b0fca4765db1e7c04c8c90bc63efef3fdc0494","modified":1642146260369}],"Category":[{"name":"React","_id":"ckye3hg4a0003i03l8tr7agg0"},{"name":"JS","_id":"ckye3hg4k000gi03ld3e21s7e"}],"Data":[],"Page":[{"title":"about","date":"2022-01-12T15:32:19.000Z","layout":"about","_content":"\n1、关于我\n\n```text\n  前端开发一枚;女儿奴;喜爱猫,家有蓝白，叫喵喵。\n```\n\n2、职业技能\n\n- 前端主流技术栈、框架\n- HTML、CSS、JS、TS\n- React\n- Vue\n- Node\n- Kubernetes 了解点概念，简单操作，考了 CKA，其他不会\n- 后端开发不会..\n\n3、工作状况\n\n- 目前就职于九州云\n- 容器相关\n\n4、学习计划\n\n- 深入学习 React Hooks\n\n5、联系我\n\n- Email: moweiwei6@gmail.com\n- GitHub: https://github.com/moweiwei\n\n6、END\n\n- Stay hungry. Stay foolish.\n- 知人者智，自知者明。胜人者有力，自胜者强。\n\n---\n\n![](/img/miaomiao.JPG)\n\n---\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2022-01-12 23:32:19\nlayout: about\n---\n\n1、关于我\n\n```text\n  前端开发一枚;女儿奴;喜爱猫,家有蓝白，叫喵喵。\n```\n\n2、职业技能\n\n- 前端主流技术栈、框架\n- HTML、CSS、JS、TS\n- React\n- Vue\n- Node\n- Kubernetes 了解点概念，简单操作，考了 CKA，其他不会\n- 后端开发不会..\n\n3、工作状况\n\n- 目前就职于九州云\n- 容器相关\n\n4、学习计划\n\n- 深入学习 React Hooks\n\n5、联系我\n\n- Email: moweiwei6@gmail.com\n- GitHub: https://github.com/moweiwei\n\n6、END\n\n- Stay hungry. Stay foolish.\n- 知人者智，自知者明。胜人者有力，自胜者强。\n\n---\n\n![](/img/miaomiao.JPG)\n\n---\n","updated":"2022-01-14T07:44:13.088Z","path":"about/index.html","comments":1,"_id":"ckye3hg430000i03l9l9h263d","content":"<p>1、关于我</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs text\">前端开发一枚;女儿奴;喜爱猫,家有蓝白，叫喵喵。<br></code></pre></div></td></tr></table></figure>\n\n<p>2、职业技能</p>\n<ul>\n<li>前端主流技术栈、框架</li>\n<li>HTML、CSS、JS、TS</li>\n<li>React</li>\n<li>Vue</li>\n<li>Node</li>\n<li>Kubernetes 了解点概念，简单操作，考了 CKA，其他不会</li>\n<li>后端开发不会..</li>\n</ul>\n<p>3、工作状况</p>\n<ul>\n<li>目前就职于九州云</li>\n<li>容器相关</li>\n</ul>\n<p>4、学习计划</p>\n<ul>\n<li>深入学习 React Hooks</li>\n</ul>\n<p>5、联系我</p>\n<ul>\n<li>Email: <a href=\"mailto:&#x6d;&#x6f;&#x77;&#x65;&#105;&#x77;&#x65;&#x69;&#x36;&#x40;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;\">&#x6d;&#x6f;&#x77;&#x65;&#105;&#x77;&#x65;&#x69;&#x36;&#x40;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;</a></li>\n<li>GitHub: <a href=\"https://github.com/moweiwei\">https://github.com/moweiwei</a></li>\n</ul>\n<p>6、END</p>\n<ul>\n<li>Stay hungry. Stay foolish.</li>\n<li>知人者智，自知者明。胜人者有力，自胜者强。</li>\n</ul>\n<hr>\n<p><img src=\"/img/miaomiao.JPG\"></p>\n<hr>\n","site":{"data":{}},"wordcount":357,"excerpt":"","more":"<p>1、关于我</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs text\">前端开发一枚;女儿奴;喜爱猫,家有蓝白，叫喵喵。<br></code></pre></td></tr></table></figure>\n\n<p>2、职业技能</p>\n<ul>\n<li>前端主流技术栈、框架</li>\n<li>HTML、CSS、JS、TS</li>\n<li>React</li>\n<li>Vue</li>\n<li>Node</li>\n<li>Kubernetes 了解点概念，简单操作，考了 CKA，其他不会</li>\n<li>后端开发不会..</li>\n</ul>\n<p>3、工作状况</p>\n<ul>\n<li>目前就职于九州云</li>\n<li>容器相关</li>\n</ul>\n<p>4、学习计划</p>\n<ul>\n<li>深入学习 React Hooks</li>\n</ul>\n<p>5、联系我</p>\n<ul>\n<li>Email: <a href=\"mailto:&#x6d;&#x6f;&#x77;&#x65;&#105;&#x77;&#x65;&#x69;&#x36;&#x40;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;\">&#x6d;&#x6f;&#x77;&#x65;&#105;&#x77;&#x65;&#x69;&#x36;&#x40;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;</a></li>\n<li>GitHub: <a href=\"https://github.com/moweiwei\">https://github.com/moweiwei</a></li>\n</ul>\n<p>6、END</p>\n<ul>\n<li>Stay hungry. Stay foolish.</li>\n<li>知人者智，自知者明。胜人者有力，自胜者强。</li>\n</ul>\n<hr>\n<p><img src=\"/img/miaomiao.JPG\"></p>\n<hr>\n"}],"Post":[{"title":"useState 引用类型数据更新不触发重新渲染问题","date":"2022-01-14T02:24:50.000Z","index_img":"/img/2022.01.14.1.png","_content":"\n## useState 函数式更新\n\n与 class 组件中的 setState 方法不同，useState 不会自动合并更新对象。你可以用函数式的 setState 结合展开运算符来达到合并更新对象的效果。\n\n```jsx\nconst [state, setState] = useState({});\nsetState((prevState) => {\n  // 也可以使用 Object.assign\n  return { ...prevState, ...updatedValues };\n});\n```\n\n## 引用类型 state 更新\n\n经常 state 数据不是简单数据类型(值类型)，而是数组、对象之类(引用类型).而 React 组件的更新机制对 state 只进行浅对比，也就是更新某个复杂类型数据时只要它的引用地址没变，那就不会重新渲染组件。\n\n尤其当被更新的引用类型数据需要依赖之前的数据时，容易踩坑,不触发更新。更新复杂 state 的时候必须传给它一个全新的对象，而不是复制了它引用地址再修改的对象。\n\n两种解决办法：\n\n1. 结合展开运算符返回一个新对象\n\n   ```jsx\n   function nextValue(preValue) {\n     let ipValue = Number.parseInt(newVal, 10);\n\n     if (Number.isNaN(ipValue)) {\n       ipValue = undefined;\n     }\n     if (ipValue < 0) {\n       ipValue = 0;\n     }\n     if (ipValue > 255) {\n       ipValue = 255;\n     }\n     preValue[index] = ipValue; //这里数据引用地址的值同样被修改\n     return [...preValue]; // 数据最外层的引用地址不同即可触发组件更新\n   }\n\n   setValue((preValue) => nextValue(preValue));\n   ```\n\n1. 深拷贝对象，用全新的副本更新数据。\n\n   ```jsx\n   function nextValue(preValue) {\n     const newValue = _.cloneDeep(preValue);\n     let ipValue = Number.parseInt(newVal, 10);\n\n     if (Number.isNaN(ipValue)) {\n       ipValue = undefined;\n     }\n     if (ipValue < 0) {\n       ipValue = 0;\n     }\n     if (ipValue > 255) {\n       ipValue = 255;\n     }\n     newValue[index] = ipValue; //这里数据引用地址的值同样被修改\n     return newValue; // 数据最外层的引用地址不同即可触发组件更新\n   }\n\n   setValue((preValue) => nextValue(preValue));\n   ```\n","source":"_posts/2022-01-14-1.md","raw":"---\ntitle: useState 引用类型数据更新不触发重新渲染问题\ndate: 2022-01-14 10:24:50\ntags: HooK\nindex_img: /img/2022.01.14.1.png\ncategories: React\n---\n\n## useState 函数式更新\n\n与 class 组件中的 setState 方法不同，useState 不会自动合并更新对象。你可以用函数式的 setState 结合展开运算符来达到合并更新对象的效果。\n\n```jsx\nconst [state, setState] = useState({});\nsetState((prevState) => {\n  // 也可以使用 Object.assign\n  return { ...prevState, ...updatedValues };\n});\n```\n\n## 引用类型 state 更新\n\n经常 state 数据不是简单数据类型(值类型)，而是数组、对象之类(引用类型).而 React 组件的更新机制对 state 只进行浅对比，也就是更新某个复杂类型数据时只要它的引用地址没变，那就不会重新渲染组件。\n\n尤其当被更新的引用类型数据需要依赖之前的数据时，容易踩坑,不触发更新。更新复杂 state 的时候必须传给它一个全新的对象，而不是复制了它引用地址再修改的对象。\n\n两种解决办法：\n\n1. 结合展开运算符返回一个新对象\n\n   ```jsx\n   function nextValue(preValue) {\n     let ipValue = Number.parseInt(newVal, 10);\n\n     if (Number.isNaN(ipValue)) {\n       ipValue = undefined;\n     }\n     if (ipValue < 0) {\n       ipValue = 0;\n     }\n     if (ipValue > 255) {\n       ipValue = 255;\n     }\n     preValue[index] = ipValue; //这里数据引用地址的值同样被修改\n     return [...preValue]; // 数据最外层的引用地址不同即可触发组件更新\n   }\n\n   setValue((preValue) => nextValue(preValue));\n   ```\n\n1. 深拷贝对象，用全新的副本更新数据。\n\n   ```jsx\n   function nextValue(preValue) {\n     const newValue = _.cloneDeep(preValue);\n     let ipValue = Number.parseInt(newVal, 10);\n\n     if (Number.isNaN(ipValue)) {\n       ipValue = undefined;\n     }\n     if (ipValue < 0) {\n       ipValue = 0;\n     }\n     if (ipValue > 255) {\n       ipValue = 255;\n     }\n     newValue[index] = ipValue; //这里数据引用地址的值同样被修改\n     return newValue; // 数据最外层的引用地址不同即可触发组件更新\n   }\n\n   setValue((preValue) => nextValue(preValue));\n   ```\n","slug":"1","published":1,"updated":"2022-01-14T02:37:25.332Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckye3hg460001i03lglbjbqu0","content":"<h2 id=\"useState-函数式更新\"><a href=\"#useState-函数式更新\" class=\"headerlink\" title=\"useState 函数式更新\"></a>useState 函数式更新</h2><p>与 class 组件中的 setState 方法不同，useState 不会自动合并更新对象。你可以用函数式的 setState 结合展开运算符来达到合并更新对象的效果。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">const</span> [state, setState] = useState(&#123;&#125;);<br>setState(<span class=\"hljs-function\">(<span class=\"hljs-params\">prevState</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 也可以使用 Object.assign</span><br>  <span class=\"hljs-keyword\">return</span> &#123; ...prevState, ...updatedValues &#125;;<br>&#125;);<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"引用类型-state-更新\"><a href=\"#引用类型-state-更新\" class=\"headerlink\" title=\"引用类型 state 更新\"></a>引用类型 state 更新</h2><p>经常 state 数据不是简单数据类型(值类型)，而是数组、对象之类(引用类型).而 React 组件的更新机制对 state 只进行浅对比，也就是更新某个复杂类型数据时只要它的引用地址没变，那就不会重新渲染组件。</p>\n<p>尤其当被更新的引用类型数据需要依赖之前的数据时，容易踩坑,不触发更新。更新复杂 state 的时候必须传给它一个全新的对象，而不是复制了它引用地址再修改的对象。</p>\n<p>两种解决办法：</p>\n<ol>\n<li><p>结合展开运算符返回一个新对象</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">nextValue</span>(<span class=\"hljs-params\">preValue</span>) </span>&#123;<br>  <span class=\"hljs-keyword\">let</span> ipValue = <span class=\"hljs-built_in\">Number</span>.parseInt(newVal, <span class=\"hljs-number\">10</span>);<br><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">Number</span>.isNaN(ipValue)) &#123;<br>    ipValue = <span class=\"hljs-literal\">undefined</span>;<br>  &#125;<br>  <span class=\"hljs-keyword\">if</span> (ipValue &lt; <span class=\"hljs-number\">0</span>) &#123;<br>    ipValue = <span class=\"hljs-number\">0</span>;<br>  &#125;<br>  <span class=\"hljs-keyword\">if</span> (ipValue &gt; <span class=\"hljs-number\">255</span>) &#123;<br>    ipValue = <span class=\"hljs-number\">255</span>;<br>  &#125;<br>  preValue[index] = ipValue; <span class=\"hljs-comment\">//这里数据引用地址的值同样被修改</span><br>  <span class=\"hljs-keyword\">return</span> [...preValue]; <span class=\"hljs-comment\">// 数据最外层的引用地址不同即可触发组件更新</span><br>&#125;<br><br>setValue(<span class=\"hljs-function\">(<span class=\"hljs-params\">preValue</span>) =&gt;</span> nextValue(preValue));<br></code></pre></div></td></tr></table></figure></li>\n<li><p>深拷贝对象，用全新的副本更新数据。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">nextValue</span>(<span class=\"hljs-params\">preValue</span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> newValue = _.cloneDeep(preValue);<br>  <span class=\"hljs-keyword\">let</span> ipValue = <span class=\"hljs-built_in\">Number</span>.parseInt(newVal, <span class=\"hljs-number\">10</span>);<br><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">Number</span>.isNaN(ipValue)) &#123;<br>    ipValue = <span class=\"hljs-literal\">undefined</span>;<br>  &#125;<br>  <span class=\"hljs-keyword\">if</span> (ipValue &lt; <span class=\"hljs-number\">0</span>) &#123;<br>    ipValue = <span class=\"hljs-number\">0</span>;<br>  &#125;<br>  <span class=\"hljs-keyword\">if</span> (ipValue &gt; <span class=\"hljs-number\">255</span>) &#123;<br>    ipValue = <span class=\"hljs-number\">255</span>;<br>  &#125;<br>  newValue[index] = ipValue; <span class=\"hljs-comment\">//这里数据引用地址的值同样被修改</span><br>  <span class=\"hljs-keyword\">return</span> newValue; <span class=\"hljs-comment\">// 数据最外层的引用地址不同即可触发组件更新</span><br>&#125;<br><br>setValue(<span class=\"hljs-function\">(<span class=\"hljs-params\">preValue</span>) =&gt;</span> nextValue(preValue));<br></code></pre></div></td></tr></table></figure></li>\n</ol>\n","site":{"data":{}},"wordcount":1239,"excerpt":"","more":"<h2 id=\"useState-函数式更新\"><a href=\"#useState-函数式更新\" class=\"headerlink\" title=\"useState 函数式更新\"></a>useState 函数式更新</h2><p>与 class 组件中的 setState 方法不同，useState 不会自动合并更新对象。你可以用函数式的 setState 结合展开运算符来达到合并更新对象的效果。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">const</span> [state, setState] = useState(&#123;&#125;);<br>setState(<span class=\"hljs-function\">(<span class=\"hljs-params\">prevState</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 也可以使用 Object.assign</span><br>  <span class=\"hljs-keyword\">return</span> &#123; ...prevState, ...updatedValues &#125;;<br>&#125;);<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"引用类型-state-更新\"><a href=\"#引用类型-state-更新\" class=\"headerlink\" title=\"引用类型 state 更新\"></a>引用类型 state 更新</h2><p>经常 state 数据不是简单数据类型(值类型)，而是数组、对象之类(引用类型).而 React 组件的更新机制对 state 只进行浅对比，也就是更新某个复杂类型数据时只要它的引用地址没变，那就不会重新渲染组件。</p>\n<p>尤其当被更新的引用类型数据需要依赖之前的数据时，容易踩坑,不触发更新。更新复杂 state 的时候必须传给它一个全新的对象，而不是复制了它引用地址再修改的对象。</p>\n<p>两种解决办法：</p>\n<ol>\n<li><p>结合展开运算符返回一个新对象</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">nextValue</span>(<span class=\"hljs-params\">preValue</span>) </span>&#123;<br>  <span class=\"hljs-keyword\">let</span> ipValue = <span class=\"hljs-built_in\">Number</span>.parseInt(newVal, <span class=\"hljs-number\">10</span>);<br><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">Number</span>.isNaN(ipValue)) &#123;<br>    ipValue = <span class=\"hljs-literal\">undefined</span>;<br>  &#125;<br>  <span class=\"hljs-keyword\">if</span> (ipValue &lt; <span class=\"hljs-number\">0</span>) &#123;<br>    ipValue = <span class=\"hljs-number\">0</span>;<br>  &#125;<br>  <span class=\"hljs-keyword\">if</span> (ipValue &gt; <span class=\"hljs-number\">255</span>) &#123;<br>    ipValue = <span class=\"hljs-number\">255</span>;<br>  &#125;<br>  preValue[index] = ipValue; <span class=\"hljs-comment\">//这里数据引用地址的值同样被修改</span><br>  <span class=\"hljs-keyword\">return</span> [...preValue]; <span class=\"hljs-comment\">// 数据最外层的引用地址不同即可触发组件更新</span><br>&#125;<br><br>setValue(<span class=\"hljs-function\">(<span class=\"hljs-params\">preValue</span>) =&gt;</span> nextValue(preValue));<br></code></pre></td></tr></table></figure></li>\n<li><p>深拷贝对象，用全新的副本更新数据。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">nextValue</span>(<span class=\"hljs-params\">preValue</span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> newValue = _.cloneDeep(preValue);<br>  <span class=\"hljs-keyword\">let</span> ipValue = <span class=\"hljs-built_in\">Number</span>.parseInt(newVal, <span class=\"hljs-number\">10</span>);<br><br>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">Number</span>.isNaN(ipValue)) &#123;<br>    ipValue = <span class=\"hljs-literal\">undefined</span>;<br>  &#125;<br>  <span class=\"hljs-keyword\">if</span> (ipValue &lt; <span class=\"hljs-number\">0</span>) &#123;<br>    ipValue = <span class=\"hljs-number\">0</span>;<br>  &#125;<br>  <span class=\"hljs-keyword\">if</span> (ipValue &gt; <span class=\"hljs-number\">255</span>) &#123;<br>    ipValue = <span class=\"hljs-number\">255</span>;<br>  &#125;<br>  newValue[index] = ipValue; <span class=\"hljs-comment\">//这里数据引用地址的值同样被修改</span><br>  <span class=\"hljs-keyword\">return</span> newValue; <span class=\"hljs-comment\">// 数据最外层的引用地址不同即可触发组件更新</span><br>&#125;<br><br>setValue(<span class=\"hljs-function\">(<span class=\"hljs-params\">preValue</span>) =&gt;</span> nextValue(preValue));<br></code></pre></td></tr></table></figure></li>\n</ol>\n"},{"title":"使用 useRef 跨生命周期保存变量","date":"2022-01-13T07:23:54.000Z","index_img":"/img/2022.01.13.1.png","_content":"\nref 这一种访问 DOM 的主要方式。然而，useRef() 比 ref 属性更有用。它可以很方便地保存任何可变值，其类似于在 class 中使用实例字段的方式.\n\n当 ref 对象内容发生变化时，useRef 并不会通知你。变更 .current 属性不会引发组件重新渲染。如果想要在 React 绑定或解绑 DOM 节点的 ref 时运行某些代码，则需要使用回调 ref 来实现。\n\n## 场景 1：只在更新时运行 useEffect\n\n使用一个可变的 ref 手动存储一个布尔值来表示是首次渲染还是后续渲染.\n\n```jsx\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  const prevCountRef = useRef(false);\n  useEffect(() => {\n    if (prevCountRef.current) {\n      console.log(\"只在更新时候执行\");\n    } else {\n      console.log(\"首次渲染执行\");\n      prevCountRef.current = true;\n    }\n  });\n\n  return (\n    <div>\n      <div>{count}</div>\n      <button\n        onClick={() => {\n          setCount(count + 1);\n        }}\n      >\n        +\n      </button>\n    </div>\n  );\n}\n```\n\n抽成自定义 hook：\n\n```jsx\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  const update = useUpdate();\n  console.log(update, \"是否更新\");\n\n  return (\n    <div>\n      <div>{count}</div>\n      <button\n        onClick={() => {\n          setCount(count + 1);\n        }}\n      >\n        +\n      </button>\n    </div>\n  );\n}\n\nfunction useUpdate() {\n  const ref = useRef(false);\n  useEffect(() => {\n    ref.current = true;\n  });\n  return ref.current;\n}\n```\n\n## 场景 2：获取上一轮的 props 或 state\n\n为什么 ref.current 拿到是上次的值？原因：\n\n1. useEffect 很重要的一点是：它是在每次渲染之后才会触发的，是延迟执行的。\n2. return 语句是同步的，所以 return 的时候，ref.current 还是旧值。\n3. 以下代码的执行顺序是 1 3 2\n\n```jsx\nfunction App() {\n  const [count, setCount] = useState(0);\n\n  const prevCountRef = useRef();\n\n  console.log(\"1\", count);\n  useEffect(() => {\n    console.log(\"2.\", count);\n    prevCountRef.current = count;\n  });\n\n  const prevCount = prevCountRef.current;\n\n  console.log(`3.之前的状态: ${prevCount};现在状态: ${count}`);\n  return (\n    <div>\n      <div>{count}</div>\n      <button\n        onClick={() => {\n          setCount(count + 1);\n        }}\n      >\n        +\n      </button>\n    </div>\n  );\n}\n```\n\n抽取成自定义 Hook:\n\n```jsx\nexport default function usePrevious(value) {\n  const ref = useRef();\n\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n\n  return ref.current;\n}\n```\n\n## 场景 3： 解决 hooks 时，由于异步闭包无法获取最新 state 的问题\n\n```jsx\nimport React, { useState, useEffect, useRef } from \"react\";\n\nconst RefComponent = () => {\n  // 使用 useState 存放和改变展示的 number\n  const [number, setNumber] = useState(0);\n  // 使用 useRef 生成一个独立的 ref 对象\n  // 在它的 current 属性单独存放一个展示的 number, 初始值为 0\n  const numRef = useRef(0);\n\n  function incrementAndDelayLogging() {\n    // 点击按钮 number + 1\n    setNumber(number + 1);\n    // 同时 ref 对象的 current 属性值也 + 1\n    numRef.current++;\n    // 定时器函数中产生了闭包, 这里 number 的是组件更新前的 number 对象, 所以值一直会滞后 1\n    setTimeout(() => alert(`state: ${number} | ref: ${numRef.current}`), 1000);\n  }\n\n  // 直接渲染的组件是正常情况, 可以获取到最新的 state,\n  // 所以 ref.current 和 state 存储的值显示一致\n  return (\n    <div>\n      <h1>solving closure by useRef</h1>\n      <button onClick={incrementAndDelayLogging}>alert in setTimeout</button>\n      <h4>state: {number}</h4>\n      <h4>ref: {numRef.current}</h4>\n    </div>\n  );\n};\n```\n","source":"_posts/2022-01-13-1.md","raw":"---\ntitle: 使用 useRef 跨生命周期保存变量\ndate: 2022-01-13 15:23:54\ntags:\n  - React\n  - HooK\nindex_img: /img/2022.01.13.1.png\ncategories: React\n---\n\nref 这一种访问 DOM 的主要方式。然而，useRef() 比 ref 属性更有用。它可以很方便地保存任何可变值，其类似于在 class 中使用实例字段的方式.\n\n当 ref 对象内容发生变化时，useRef 并不会通知你。变更 .current 属性不会引发组件重新渲染。如果想要在 React 绑定或解绑 DOM 节点的 ref 时运行某些代码，则需要使用回调 ref 来实现。\n\n## 场景 1：只在更新时运行 useEffect\n\n使用一个可变的 ref 手动存储一个布尔值来表示是首次渲染还是后续渲染.\n\n```jsx\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  const prevCountRef = useRef(false);\n  useEffect(() => {\n    if (prevCountRef.current) {\n      console.log(\"只在更新时候执行\");\n    } else {\n      console.log(\"首次渲染执行\");\n      prevCountRef.current = true;\n    }\n  });\n\n  return (\n    <div>\n      <div>{count}</div>\n      <button\n        onClick={() => {\n          setCount(count + 1);\n        }}\n      >\n        +\n      </button>\n    </div>\n  );\n}\n```\n\n抽成自定义 hook：\n\n```jsx\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  const update = useUpdate();\n  console.log(update, \"是否更新\");\n\n  return (\n    <div>\n      <div>{count}</div>\n      <button\n        onClick={() => {\n          setCount(count + 1);\n        }}\n      >\n        +\n      </button>\n    </div>\n  );\n}\n\nfunction useUpdate() {\n  const ref = useRef(false);\n  useEffect(() => {\n    ref.current = true;\n  });\n  return ref.current;\n}\n```\n\n## 场景 2：获取上一轮的 props 或 state\n\n为什么 ref.current 拿到是上次的值？原因：\n\n1. useEffect 很重要的一点是：它是在每次渲染之后才会触发的，是延迟执行的。\n2. return 语句是同步的，所以 return 的时候，ref.current 还是旧值。\n3. 以下代码的执行顺序是 1 3 2\n\n```jsx\nfunction App() {\n  const [count, setCount] = useState(0);\n\n  const prevCountRef = useRef();\n\n  console.log(\"1\", count);\n  useEffect(() => {\n    console.log(\"2.\", count);\n    prevCountRef.current = count;\n  });\n\n  const prevCount = prevCountRef.current;\n\n  console.log(`3.之前的状态: ${prevCount};现在状态: ${count}`);\n  return (\n    <div>\n      <div>{count}</div>\n      <button\n        onClick={() => {\n          setCount(count + 1);\n        }}\n      >\n        +\n      </button>\n    </div>\n  );\n}\n```\n\n抽取成自定义 Hook:\n\n```jsx\nexport default function usePrevious(value) {\n  const ref = useRef();\n\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n\n  return ref.current;\n}\n```\n\n## 场景 3： 解决 hooks 时，由于异步闭包无法获取最新 state 的问题\n\n```jsx\nimport React, { useState, useEffect, useRef } from \"react\";\n\nconst RefComponent = () => {\n  // 使用 useState 存放和改变展示的 number\n  const [number, setNumber] = useState(0);\n  // 使用 useRef 生成一个独立的 ref 对象\n  // 在它的 current 属性单独存放一个展示的 number, 初始值为 0\n  const numRef = useRef(0);\n\n  function incrementAndDelayLogging() {\n    // 点击按钮 number + 1\n    setNumber(number + 1);\n    // 同时 ref 对象的 current 属性值也 + 1\n    numRef.current++;\n    // 定时器函数中产生了闭包, 这里 number 的是组件更新前的 number 对象, 所以值一直会滞后 1\n    setTimeout(() => alert(`state: ${number} | ref: ${numRef.current}`), 1000);\n  }\n\n  // 直接渲染的组件是正常情况, 可以获取到最新的 state,\n  // 所以 ref.current 和 state 存储的值显示一致\n  return (\n    <div>\n      <h1>solving closure by useRef</h1>\n      <button onClick={incrementAndDelayLogging}>alert in setTimeout</button>\n      <h4>state: {number}</h4>\n      <h4>ref: {numRef.current}</h4>\n    </div>\n  );\n};\n```\n","slug":"1","published":1,"updated":"2022-01-14T02:37:59.106Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckye3hg490002i03l453cajhf","content":"<p>ref 这一种访问 DOM 的主要方式。然而，useRef() 比 ref 属性更有用。它可以很方便地保存任何可变值，其类似于在 class 中使用实例字段的方式.</p>\n<p>当 ref 对象内容发生变化时，useRef 并不会通知你。变更 .current 属性不会引发组件重新渲染。如果想要在 React 绑定或解绑 DOM 节点的 ref 时运行某些代码，则需要使用回调 ref 来实现。</p>\n<h2 id=\"场景-1：只在更新时运行-useEffect\"><a href=\"#场景-1：只在更新时运行-useEffect\" class=\"headerlink\" title=\"场景 1：只在更新时运行 useEffect\"></a>场景 1：只在更新时运行 useEffect</h2><p>使用一个可变的 ref 手动存储一个布尔值来表示是首次渲染还是后续渲染.</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">Example</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = useState(<span class=\"hljs-number\">0</span>);<br><br>  <span class=\"hljs-keyword\">const</span> prevCountRef = useRef(<span class=\"hljs-literal\">false</span>);<br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (prevCountRef.current) &#123;<br>      <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;只在更新时候执行&quot;</span>);<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;首次渲染执行&quot;</span>);<br>      prevCountRef.current = <span class=\"hljs-literal\">true</span>;<br>    &#125;<br>  &#125;);<br><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&#123;count&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span></span></span><br><span class=\"hljs-tag\"><span class=\"xml\">        <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> &#123;</span><br><span class=\"xml\">          setCount(count + 1);</span><br><span class=\"xml\">        &#125;&#125;</span><br><span class=\"xml\">      &gt;</span><br><span class=\"xml\">        +</span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>抽成自定义 hook：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">Example</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = useState(<span class=\"hljs-number\">0</span>);<br><br>  <span class=\"hljs-keyword\">const</span> update = useUpdate();<br>  <span class=\"hljs-built_in\">console</span>.log(update, <span class=\"hljs-string\">&quot;是否更新&quot;</span>);<br><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&#123;count&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span></span></span><br><span class=\"hljs-tag\"><span class=\"xml\">        <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> &#123;</span><br><span class=\"xml\">          setCount(count + 1);</span><br><span class=\"xml\">        &#125;&#125;</span><br><span class=\"xml\">      &gt;</span><br><span class=\"xml\">        +</span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">useUpdate</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> ref = useRef(<span class=\"hljs-literal\">false</span>);<br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    ref.current = <span class=\"hljs-literal\">true</span>;<br>  &#125;);<br>  <span class=\"hljs-keyword\">return</span> ref.current;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"场景-2：获取上一轮的-props-或-state\"><a href=\"#场景-2：获取上一轮的-props-或-state\" class=\"headerlink\" title=\"场景 2：获取上一轮的 props 或 state\"></a>场景 2：获取上一轮的 props 或 state</h2><p>为什么 ref.current 拿到是上次的值？原因：</p>\n<ol>\n<li>useEffect 很重要的一点是：它是在每次渲染之后才会触发的，是延迟执行的。</li>\n<li>return 语句是同步的，所以 return 的时候，ref.current 还是旧值。</li>\n<li>以下代码的执行顺序是 1 3 2</li>\n</ol>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">App</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = useState(<span class=\"hljs-number\">0</span>);<br><br>  <span class=\"hljs-keyword\">const</span> prevCountRef = useRef();<br><br>  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;1&quot;</span>, count);<br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;2.&quot;</span>, count);<br>    prevCountRef.current = count;<br>  &#125;);<br><br>  <span class=\"hljs-keyword\">const</span> prevCount = prevCountRef.current;<br><br>  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">`3.之前的状态: <span class=\"hljs-subst\">$&#123;prevCount&#125;</span>;现在状态: <span class=\"hljs-subst\">$&#123;count&#125;</span>`</span>);<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&#123;count&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span></span></span><br><span class=\"hljs-tag\"><span class=\"xml\">        <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> &#123;</span><br><span class=\"xml\">          setCount(count + 1);</span><br><span class=\"xml\">        &#125;&#125;</span><br><span class=\"xml\">      &gt;</span><br><span class=\"xml\">        +</span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<p>抽取成自定义 Hook:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">usePrevious</span>(<span class=\"hljs-params\">value</span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> ref = useRef();<br><br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    ref.current = value;<br>  &#125;, [value]);<br><br>  <span class=\"hljs-keyword\">return</span> ref.current;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"场景-3：-解决-hooks-时，由于异步闭包无法获取最新-state-的问题\"><a href=\"#场景-3：-解决-hooks-时，由于异步闭包无法获取最新-state-的问题\" class=\"headerlink\" title=\"场景 3： 解决 hooks 时，由于异步闭包无法获取最新 state 的问题\"></a>场景 3： 解决 hooks 时，由于异步闭包无法获取最新 state 的问题</h2><figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> React, &#123; useState, useEffect, useRef &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><br><span class=\"hljs-keyword\">const</span> RefComponent = <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 使用 useState 存放和改变展示的 number</span><br>  <span class=\"hljs-keyword\">const</span> [number, setNumber] = useState(<span class=\"hljs-number\">0</span>);<br>  <span class=\"hljs-comment\">// 使用 useRef 生成一个独立的 ref 对象</span><br>  <span class=\"hljs-comment\">// 在它的 current 属性单独存放一个展示的 number, 初始值为 0</span><br>  <span class=\"hljs-keyword\">const</span> numRef = useRef(<span class=\"hljs-number\">0</span>);<br><br>  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">incrementAndDelayLogging</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>    <span class=\"hljs-comment\">// 点击按钮 number + 1</span><br>    setNumber(number + <span class=\"hljs-number\">1</span>);<br>    <span class=\"hljs-comment\">// 同时 ref 对象的 current 属性值也 + 1</span><br>    numRef.current++;<br>    <span class=\"hljs-comment\">// 定时器函数中产生了闭包, 这里 number 的是组件更新前的 number 对象, 所以值一直会滞后 1</span><br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> alert(<span class=\"hljs-string\">`state: <span class=\"hljs-subst\">$&#123;number&#125;</span> | ref: <span class=\"hljs-subst\">$&#123;numRef.current&#125;</span>`</span>), <span class=\"hljs-number\">1000</span>);<br>  &#125;<br><br>  <span class=\"hljs-comment\">// 直接渲染的组件是正常情况, 可以获取到最新的 state,</span><br>  <span class=\"hljs-comment\">// 所以 ref.current 和 state 存储的值显示一致</span><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>solving closure by useRef<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;incrementAndDelayLogging&#125;</span>&gt;</span>alert in setTimeout<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h4</span>&gt;</span>state: &#123;number&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h4</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h4</span>&gt;</span>ref: &#123;numRef.current&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h4</span>&gt;</span></span><br><span class=\"xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></div></td></tr></table></figure>\n","site":{"data":{}},"wordcount":2888,"excerpt":"","more":"<p>ref 这一种访问 DOM 的主要方式。然而，useRef() 比 ref 属性更有用。它可以很方便地保存任何可变值，其类似于在 class 中使用实例字段的方式.</p>\n<p>当 ref 对象内容发生变化时，useRef 并不会通知你。变更 .current 属性不会引发组件重新渲染。如果想要在 React 绑定或解绑 DOM 节点的 ref 时运行某些代码，则需要使用回调 ref 来实现。</p>\n<h2 id=\"场景-1：只在更新时运行-useEffect\"><a href=\"#场景-1：只在更新时运行-useEffect\" class=\"headerlink\" title=\"场景 1：只在更新时运行 useEffect\"></a>场景 1：只在更新时运行 useEffect</h2><p>使用一个可变的 ref 手动存储一个布尔值来表示是首次渲染还是后续渲染.</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">Example</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = useState(<span class=\"hljs-number\">0</span>);<br><br>  <span class=\"hljs-keyword\">const</span> prevCountRef = useRef(<span class=\"hljs-literal\">false</span>);<br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">if</span> (prevCountRef.current) &#123;<br>      <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;只在更新时候执行&quot;</span>);<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>      <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;首次渲染执行&quot;</span>);<br>      prevCountRef.current = <span class=\"hljs-literal\">true</span>;<br>    &#125;<br>  &#125;);<br><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&#123;count&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span></span></span><br><span class=\"hljs-tag\"><span class=\"xml\">        <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> &#123;</span><br><span class=\"xml\">          setCount(count + 1);</span><br><span class=\"xml\">        &#125;&#125;</span><br><span class=\"xml\">      &gt;</span><br><span class=\"xml\">        +</span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>抽成自定义 hook：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">Example</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = useState(<span class=\"hljs-number\">0</span>);<br><br>  <span class=\"hljs-keyword\">const</span> update = useUpdate();<br>  <span class=\"hljs-built_in\">console</span>.log(update, <span class=\"hljs-string\">&quot;是否更新&quot;</span>);<br><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&#123;count&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span></span></span><br><span class=\"hljs-tag\"><span class=\"xml\">        <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> &#123;</span><br><span class=\"xml\">          setCount(count + 1);</span><br><span class=\"xml\">        &#125;&#125;</span><br><span class=\"xml\">      &gt;</span><br><span class=\"xml\">        +</span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">useUpdate</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> ref = useRef(<span class=\"hljs-literal\">false</span>);<br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    ref.current = <span class=\"hljs-literal\">true</span>;<br>  &#125;);<br>  <span class=\"hljs-keyword\">return</span> ref.current;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"场景-2：获取上一轮的-props-或-state\"><a href=\"#场景-2：获取上一轮的-props-或-state\" class=\"headerlink\" title=\"场景 2：获取上一轮的 props 或 state\"></a>场景 2：获取上一轮的 props 或 state</h2><p>为什么 ref.current 拿到是上次的值？原因：</p>\n<ol>\n<li>useEffect 很重要的一点是：它是在每次渲染之后才会触发的，是延迟执行的。</li>\n<li>return 语句是同步的，所以 return 的时候，ref.current 还是旧值。</li>\n<li>以下代码的执行顺序是 1 3 2</li>\n</ol>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">App</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> [count, setCount] = useState(<span class=\"hljs-number\">0</span>);<br><br>  <span class=\"hljs-keyword\">const</span> prevCountRef = useRef();<br><br>  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;1&quot;</span>, count);<br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;2.&quot;</span>, count);<br>    prevCountRef.current = count;<br>  &#125;);<br><br>  <span class=\"hljs-keyword\">const</span> prevCount = prevCountRef.current;<br><br>  <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">`3.之前的状态: <span class=\"hljs-subst\">$&#123;prevCount&#125;</span>;现在状态: <span class=\"hljs-subst\">$&#123;count&#125;</span>`</span>);<br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>&#123;count&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span></span></span><br><span class=\"hljs-tag\"><span class=\"xml\">        <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;()</span> =&gt;</span> &#123;</span><br><span class=\"xml\">          setCount(count + 1);</span><br><span class=\"xml\">        &#125;&#125;</span><br><span class=\"xml\">      &gt;</span><br><span class=\"xml\">        +</span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>抽取成自定义 Hook:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">usePrevious</span>(<span class=\"hljs-params\">value</span>) </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> ref = useRef();<br><br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    ref.current = value;<br>  &#125;, [value]);<br><br>  <span class=\"hljs-keyword\">return</span> ref.current;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"场景-3：-解决-hooks-时，由于异步闭包无法获取最新-state-的问题\"><a href=\"#场景-3：-解决-hooks-时，由于异步闭包无法获取最新-state-的问题\" class=\"headerlink\" title=\"场景 3： 解决 hooks 时，由于异步闭包无法获取最新 state 的问题\"></a>场景 3： 解决 hooks 时，由于异步闭包无法获取最新 state 的问题</h2><figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> React, &#123; useState, useEffect, useRef &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><br><span class=\"hljs-keyword\">const</span> RefComponent = <span class=\"hljs-function\">() =&gt;</span> &#123;<br>  <span class=\"hljs-comment\">// 使用 useState 存放和改变展示的 number</span><br>  <span class=\"hljs-keyword\">const</span> [number, setNumber] = useState(<span class=\"hljs-number\">0</span>);<br>  <span class=\"hljs-comment\">// 使用 useRef 生成一个独立的 ref 对象</span><br>  <span class=\"hljs-comment\">// 在它的 current 属性单独存放一个展示的 number, 初始值为 0</span><br>  <span class=\"hljs-keyword\">const</span> numRef = useRef(<span class=\"hljs-number\">0</span>);<br><br>  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">incrementAndDelayLogging</span>(<span class=\"hljs-params\"></span>) </span>&#123;<br>    <span class=\"hljs-comment\">// 点击按钮 number + 1</span><br>    setNumber(number + <span class=\"hljs-number\">1</span>);<br>    <span class=\"hljs-comment\">// 同时 ref 对象的 current 属性值也 + 1</span><br>    numRef.current++;<br>    <span class=\"hljs-comment\">// 定时器函数中产生了闭包, 这里 number 的是组件更新前的 number 对象, 所以值一直会滞后 1</span><br>    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> alert(<span class=\"hljs-string\">`state: <span class=\"hljs-subst\">$&#123;number&#125;</span> | ref: <span class=\"hljs-subst\">$&#123;numRef.current&#125;</span>`</span>), <span class=\"hljs-number\">1000</span>);<br>  &#125;<br><br>  <span class=\"hljs-comment\">// 直接渲染的组件是正常情况, 可以获取到最新的 state,</span><br>  <span class=\"hljs-comment\">// 所以 ref.current 和 state 存储的值显示一致</span><br>  <span class=\"hljs-keyword\">return</span> (<br>    <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>solving closure by useRef<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">&#123;incrementAndDelayLogging&#125;</span>&gt;</span>alert in setTimeout<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h4</span>&gt;</span>state: &#123;number&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h4</span>&gt;</span></span><br><span class=\"xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h4</span>&gt;</span>ref: &#123;numRef.current&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h4</span>&gt;</span></span><br><span class=\"xml\">    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>\n"},{"title":"如何在 class 组件中使用 hooks","index_img":"/img/2022.01.14.2.png","date":"2022-01-14T03:03:28.000Z","_content":"\n## 解决办法\n\n以一个简单的 `useScreenWidthhook` 函数为例，它的目的是获取全屏的宽度，并且去监听浏览器窗口的变化，更新宽度：\n\n```jsx\nimport { useEffect, useState } from \"react\";\n\nexport function useScreenWidth(): number {\n  const [width, setWidth] = useState(window.innerWidth);\n\n  useEffect(() => {\n    const handler = (event: any) => {\n      setWidth(event.target.innerWidth);\n    };\n    // 监听浏览器窗口变化\n    window.addEventListener(\"resize\", handler);\n    // 组件unmount时要解除监听\n    return () => {\n      window.removeEventListener(\"resize\", handler);\n    };\n  }, []);\n\n  return width;\n}\n```\n\n## 方法 1：将 Hook 包装成 HOC\n\nHOC 是 React 中复用组件的高级用法，它的本质是一个函数，它的输入参数是一个组件，返回相同的组件以及一些额外的 props。在我们的例子里，可以让 hook 函数作为 props 传递到目标组件中:\n\n```jsx\nimport React from \"react\";\nimport { useScreenWidth } from \"../hooks/useScreenWidth\";\n\nexport const withHooksHOC = (Component: any) => {\n  return (props: any) => {\n    const screenWidth = useScreenWidth();\n\n    return <Component width={screenWidth} {...props} />;\n  };\n};\n```\n\n将我们的目标组件用上述的 withHooksHOC 包装起来\n\n```jsx\nimport React from \"react\";\nimport { withHooksHOC } from \"./withHooksHOC\";\n\ninterface IHooksHOCProps {\n  width: number;\n}\n\nclass HooksHOC extends React.Component<IHooksHOCProps> {\n  render() {\n    return <p>width: {this.props.width}</p>;\n  }\n}\n\nexport default withHooksHOC(HooksHOC);\n```\n\n## 方法 2：将 Hook 包装成函数组件\n\n将 hook 变成函数组件，它接收一个参数为 width 的 children 函数，然后将 width 作为 render prop 传递：\n\n```jsx\nimport { FunctionComponent } from \"react\";\nimport { useScreenWidth } from \"../hooks/useScreenWidth\";\n\ntype ScreenWidthChildren = (screenWidth: number) => React.ReactNode;\n\ninterface IScreenWidthProps {\n  children: ScreenWidthChildren;\n}\n\nexport const ScreenWidth: FunctionComponent<IScreenWidthProps> = ({ children }) => {\n  const screenWidth: number = useScreenWidth();\n\n  return children(screenWidth);\n};\n```\n\n使用：\n\n```jsx\nimport React from \"react\";\nimport { ScreenWidth } from \"./ScreenWidth\";\n\nexport class HooksRenderProps extends React.Component {\n  render() {\n    return <ScreenWidth>{(width) => <p style={{ fontSize: \"48px\" }}>width: {width}</p>}</ScreenWidth>;\n  }\n}\n```\n","source":"_posts/2022-01-14-2.md","raw":"---\ntitle: 如何在 class 组件中使用 hooks\nindex_img: /img/2022.01.14.2.png\ndate: 2022-01-14 11:03:28\ntags: HooK\ncategories: React\n---\n\n## 解决办法\n\n以一个简单的 `useScreenWidthhook` 函数为例，它的目的是获取全屏的宽度，并且去监听浏览器窗口的变化，更新宽度：\n\n```jsx\nimport { useEffect, useState } from \"react\";\n\nexport function useScreenWidth(): number {\n  const [width, setWidth] = useState(window.innerWidth);\n\n  useEffect(() => {\n    const handler = (event: any) => {\n      setWidth(event.target.innerWidth);\n    };\n    // 监听浏览器窗口变化\n    window.addEventListener(\"resize\", handler);\n    // 组件unmount时要解除监听\n    return () => {\n      window.removeEventListener(\"resize\", handler);\n    };\n  }, []);\n\n  return width;\n}\n```\n\n## 方法 1：将 Hook 包装成 HOC\n\nHOC 是 React 中复用组件的高级用法，它的本质是一个函数，它的输入参数是一个组件，返回相同的组件以及一些额外的 props。在我们的例子里，可以让 hook 函数作为 props 传递到目标组件中:\n\n```jsx\nimport React from \"react\";\nimport { useScreenWidth } from \"../hooks/useScreenWidth\";\n\nexport const withHooksHOC = (Component: any) => {\n  return (props: any) => {\n    const screenWidth = useScreenWidth();\n\n    return <Component width={screenWidth} {...props} />;\n  };\n};\n```\n\n将我们的目标组件用上述的 withHooksHOC 包装起来\n\n```jsx\nimport React from \"react\";\nimport { withHooksHOC } from \"./withHooksHOC\";\n\ninterface IHooksHOCProps {\n  width: number;\n}\n\nclass HooksHOC extends React.Component<IHooksHOCProps> {\n  render() {\n    return <p>width: {this.props.width}</p>;\n  }\n}\n\nexport default withHooksHOC(HooksHOC);\n```\n\n## 方法 2：将 Hook 包装成函数组件\n\n将 hook 变成函数组件，它接收一个参数为 width 的 children 函数，然后将 width 作为 render prop 传递：\n\n```jsx\nimport { FunctionComponent } from \"react\";\nimport { useScreenWidth } from \"../hooks/useScreenWidth\";\n\ntype ScreenWidthChildren = (screenWidth: number) => React.ReactNode;\n\ninterface IScreenWidthProps {\n  children: ScreenWidthChildren;\n}\n\nexport const ScreenWidth: FunctionComponent<IScreenWidthProps> = ({ children }) => {\n  const screenWidth: number = useScreenWidth();\n\n  return children(screenWidth);\n};\n```\n\n使用：\n\n```jsx\nimport React from \"react\";\nimport { ScreenWidth } from \"./ScreenWidth\";\n\nexport class HooksRenderProps extends React.Component {\n  render() {\n    return <ScreenWidth>{(width) => <p style={{ fontSize: \"48px\" }}>width: {width}</p>}</ScreenWidth>;\n  }\n}\n```\n","slug":"2","published":1,"updated":"2022-01-14T05:57:32.234Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckye3hg4j000di03lekrig6x1","content":"<h2 id=\"解决办法\"><a href=\"#解决办法\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h2><p>以一个简单的 <code>useScreenWidthhook</code> 函数为例，它的目的是获取全屏的宽度，并且去监听浏览器窗口的变化，更新宽度：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> &#123; useEffect, useState &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">useScreenWidth</span>(<span class=\"hljs-params\"></span>): <span class=\"hljs-title\">number</span> </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> [width, setWidth] = useState(<span class=\"hljs-built_in\">window</span>.innerWidth);<br><br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> handler = <span class=\"hljs-function\">(<span class=\"hljs-params\">event: any</span>) =&gt;</span> &#123;<br>      setWidth(event.target.innerWidth);<br>    &#125;;<br>    <span class=\"hljs-comment\">// 监听浏览器窗口变化</span><br>    <span class=\"hljs-built_in\">window</span>.addEventListener(<span class=\"hljs-string\">&quot;resize&quot;</span>, handler);<br>    <span class=\"hljs-comment\">// 组件unmount时要解除监听</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-built_in\">window</span>.removeEventListener(<span class=\"hljs-string\">&quot;resize&quot;</span>, handler);<br>    &#125;;<br>  &#125;, []);<br><br>  <span class=\"hljs-keyword\">return</span> width;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"方法-1：将-Hook-包装成-HOC\"><a href=\"#方法-1：将-Hook-包装成-HOC\" class=\"headerlink\" title=\"方法 1：将 Hook 包装成 HOC\"></a>方法 1：将 Hook 包装成 HOC</h2><p>HOC 是 React 中复用组件的高级用法，它的本质是一个函数，它的输入参数是一个组件，返回相同的组件以及一些额外的 props。在我们的例子里，可以让 hook 函数作为 props 传递到目标组件中:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><span class=\"hljs-keyword\">import</span> &#123; useScreenWidth &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../hooks/useScreenWidth&quot;</span>;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> withHooksHOC = <span class=\"hljs-function\">(<span class=\"hljs-params\">Component: any</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">props: any</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> screenWidth = useScreenWidth();<br><br>    <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Component</span> <span class=\"hljs-attr\">width</span>=<span class=\"hljs-string\">&#123;screenWidth&#125;</span> &#123;<span class=\"hljs-attr\">...props</span>&#125; /&gt;</span></span>;<br>  &#125;;<br>&#125;;<br></code></pre></div></td></tr></table></figure>\n\n<p>将我们的目标组件用上述的 withHooksHOC 包装起来</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><span class=\"hljs-keyword\">import</span> &#123; withHooksHOC &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./withHooksHOC&quot;</span>;<br><br>interface IHooksHOCProps &#123;<br>  <span class=\"hljs-attr\">width</span>: number;<br>&#125;<br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HooksHOC</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">React</span>.<span class=\"hljs-title\">Component</span>&lt;<span class=\"hljs-title\">IHooksHOCProps</span>&gt; </span>&#123;<br>  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>width: &#123;this.props.width&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> withHooksHOC(HooksHOC);<br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"方法-2：将-Hook-包装成函数组件\"><a href=\"#方法-2：将-Hook-包装成函数组件\" class=\"headerlink\" title=\"方法 2：将 Hook 包装成函数组件\"></a>方法 2：将 Hook 包装成函数组件</h2><p>将 hook 变成函数组件，它接收一个参数为 width 的 children 函数，然后将 width 作为 render prop 传递：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> &#123; FunctionComponent &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><span class=\"hljs-keyword\">import</span> &#123; useScreenWidth &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../hooks/useScreenWidth&quot;</span>;<br><br>type ScreenWidthChildren = <span class=\"hljs-function\">(<span class=\"hljs-params\">screenWidth: number</span>) =&gt;</span> React.ReactNode;<br><br>interface IScreenWidthProps &#123;<br>  <span class=\"hljs-attr\">children</span>: ScreenWidthChildren;<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> ScreenWidth: FunctionComponent&lt;IScreenWidthProps&gt; = <span class=\"hljs-function\">(<span class=\"hljs-params\">&#123; children &#125;</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> screenWidth: number = useScreenWidth();<br><br>  <span class=\"hljs-keyword\">return</span> children(screenWidth);<br>&#125;;<br></code></pre></div></td></tr></table></figure>\n\n<p>使用：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><span class=\"hljs-keyword\">import</span> &#123; ScreenWidth &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./ScreenWidth&quot;</span>;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HooksRenderProps</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">React</span>.<span class=\"hljs-title\">Component</span> </span>&#123;<br>  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ScreenWidth</span>&gt;</span>&#123;(width) =&gt; <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&#123;&#123;</span> <span class=\"hljs-attr\">fontSize:</span> &quot;<span class=\"hljs-attr\">48px</span>&quot; &#125;&#125;&gt;</span>width: &#123;width&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ScreenWidth</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>\n","site":{"data":{}},"wordcount":2216,"excerpt":"","more":"<h2 id=\"解决办法\"><a href=\"#解决办法\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h2><p>以一个简单的 <code>useScreenWidthhook</code> 函数为例，它的目的是获取全屏的宽度，并且去监听浏览器窗口的变化，更新宽度：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> &#123; useEffect, useState &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">useScreenWidth</span>(<span class=\"hljs-params\"></span>): <span class=\"hljs-title\">number</span> </span>&#123;<br>  <span class=\"hljs-keyword\">const</span> [width, setWidth] = useState(<span class=\"hljs-built_in\">window</span>.innerWidth);<br><br>  useEffect(<span class=\"hljs-function\">() =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> handler = <span class=\"hljs-function\">(<span class=\"hljs-params\">event: any</span>) =&gt;</span> &#123;<br>      setWidth(event.target.innerWidth);<br>    &#125;;<br>    <span class=\"hljs-comment\">// 监听浏览器窗口变化</span><br>    <span class=\"hljs-built_in\">window</span>.addEventListener(<span class=\"hljs-string\">&quot;resize&quot;</span>, handler);<br>    <span class=\"hljs-comment\">// 组件unmount时要解除监听</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">() =&gt;</span> &#123;<br>      <span class=\"hljs-built_in\">window</span>.removeEventListener(<span class=\"hljs-string\">&quot;resize&quot;</span>, handler);<br>    &#125;;<br>  &#125;, []);<br><br>  <span class=\"hljs-keyword\">return</span> width;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"方法-1：将-Hook-包装成-HOC\"><a href=\"#方法-1：将-Hook-包装成-HOC\" class=\"headerlink\" title=\"方法 1：将 Hook 包装成 HOC\"></a>方法 1：将 Hook 包装成 HOC</h2><p>HOC 是 React 中复用组件的高级用法，它的本质是一个函数，它的输入参数是一个组件，返回相同的组件以及一些额外的 props。在我们的例子里，可以让 hook 函数作为 props 传递到目标组件中:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><span class=\"hljs-keyword\">import</span> &#123; useScreenWidth &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../hooks/useScreenWidth&quot;</span>;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> withHooksHOC = <span class=\"hljs-function\">(<span class=\"hljs-params\">Component: any</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">(<span class=\"hljs-params\">props: any</span>) =&gt;</span> &#123;<br>    <span class=\"hljs-keyword\">const</span> screenWidth = useScreenWidth();<br><br>    <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Component</span> <span class=\"hljs-attr\">width</span>=<span class=\"hljs-string\">&#123;screenWidth&#125;</span> &#123;<span class=\"hljs-attr\">...props</span>&#125; /&gt;</span></span>;<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>\n\n<p>将我们的目标组件用上述的 withHooksHOC 包装起来</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><span class=\"hljs-keyword\">import</span> &#123; withHooksHOC &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./withHooksHOC&quot;</span>;<br><br>interface IHooksHOCProps &#123;<br>  <span class=\"hljs-attr\">width</span>: number;<br>&#125;<br><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HooksHOC</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">React</span>.<span class=\"hljs-title\">Component</span>&lt;<span class=\"hljs-title\">IHooksHOCProps</span>&gt; </span>&#123;<br>  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span>&gt;</span>width: &#123;this.props.width&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> withHooksHOC(HooksHOC);<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"方法-2：将-Hook-包装成函数组件\"><a href=\"#方法-2：将-Hook-包装成函数组件\" class=\"headerlink\" title=\"方法 2：将 Hook 包装成函数组件\"></a>方法 2：将 Hook 包装成函数组件</h2><p>将 hook 变成函数组件，它接收一个参数为 width 的 children 函数，然后将 width 作为 render prop 传递：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> &#123; FunctionComponent &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><span class=\"hljs-keyword\">import</span> &#123; useScreenWidth &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../hooks/useScreenWidth&quot;</span>;<br><br>type ScreenWidthChildren = <span class=\"hljs-function\">(<span class=\"hljs-params\">screenWidth: number</span>) =&gt;</span> React.ReactNode;<br><br>interface IScreenWidthProps &#123;<br>  <span class=\"hljs-attr\">children</span>: ScreenWidthChildren;<br>&#125;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> ScreenWidth: FunctionComponent&lt;IScreenWidthProps&gt; = <span class=\"hljs-function\">(<span class=\"hljs-params\">&#123; children &#125;</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> screenWidth: number = useScreenWidth();<br><br>  <span class=\"hljs-keyword\">return</span> children(screenWidth);<br>&#125;;<br></code></pre></td></tr></table></figure>\n\n<p>使用：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs jsx\"><span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;<br><span class=\"hljs-keyword\">import</span> &#123; ScreenWidth &#125; <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./ScreenWidth&quot;</span>;<br><br><span class=\"hljs-keyword\">export</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HooksRenderProps</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">React</span>.<span class=\"hljs-title\">Component</span> </span>&#123;<br>  <span class=\"hljs-function\"><span class=\"hljs-title\">render</span>(<span class=\"hljs-params\"></span>)</span> &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ScreenWidth</span>&gt;</span>&#123;(width) =&gt; <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">p</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">&#123;&#123;</span> <span class=\"hljs-attr\">fontSize:</span> &quot;<span class=\"hljs-attr\">48px</span>&quot; &#125;&#125;&gt;</span>width: &#123;width&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">p</span>&gt;</span>&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ScreenWidth</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n"},{"title":"map 到底改不改变原数组","index_img":"/img/2022.01.14.3.png","date":"2022-01-14T05:53:44.000Z","_content":"\nmap 到底改不改变原数组\n\n一般认为 map 不会对原数组进行修改，但事实并不是如此。\n\n## 数组内为基础类型数据时,原数组不变\n\n```js\nlet array = [1, 2, 3, 4, 5];\nlet newArray = array.map((item) => item * 2);\nconsole.log(array); // [1,2,3,4,5]\nconsole.log(newArray); //[2, 4, 6, 8, 10]\n```\n\n## 数据内是引用类型数据时，注意写法\n\n1. item 上直接修改，改变原数组\n\n   ```js\n   let array = [\n     { name: \"Anna\", age: 16 },\n     { name: \"James\", age: 18 }\n   ];\n   let newArray = array.map((item) => {\n     item.like = \"eat\";\n     return item;\n   });\n   console.log(array); // [{ name: 'Anna', age: 16,like: \"eat\"},{ name: 'James', age: 18,like: \"eat\"}]\n   console.log(newArray); //[{ name: 'Anna', age: 16,like: \"eat\"},{ name: 'James', age: 18,like: \"eat\"}]\n   ```\n\n1. 开辟新的引用地址, 不改变原数组\n\n   ```js\n   let array = [\n     { name: \"Anna\", age: 16 },\n     { name: \"James\", age: 18 }\n   ];\n   let newArray = array.map((item) => {\n     const obj = { ...item, like: \"eat\" };\n     return obj;\n   });\n   console.log(array); // [{ name: 'Anna', age: 16},{ name: 'James', age: 18}]\n   console.log(newArray); //[{ name: 'Anna', age: 16,like: \"eat\"},{ name: 'James', age: 18,like: \"eat\"}]\n   ```\n","source":"_posts/2022-01-14-3.md","raw":"---\ntitle: map 到底改不改变原数组\nindex_img: /img/2022.01.14.3.png\ndate: 2022-01-14 13:53:44\ntags: map\ncategories: JS\n---\n\nmap 到底改不改变原数组\n\n一般认为 map 不会对原数组进行修改，但事实并不是如此。\n\n## 数组内为基础类型数据时,原数组不变\n\n```js\nlet array = [1, 2, 3, 4, 5];\nlet newArray = array.map((item) => item * 2);\nconsole.log(array); // [1,2,3,4,5]\nconsole.log(newArray); //[2, 4, 6, 8, 10]\n```\n\n## 数据内是引用类型数据时，注意写法\n\n1. item 上直接修改，改变原数组\n\n   ```js\n   let array = [\n     { name: \"Anna\", age: 16 },\n     { name: \"James\", age: 18 }\n   ];\n   let newArray = array.map((item) => {\n     item.like = \"eat\";\n     return item;\n   });\n   console.log(array); // [{ name: 'Anna', age: 16,like: \"eat\"},{ name: 'James', age: 18,like: \"eat\"}]\n   console.log(newArray); //[{ name: 'Anna', age: 16,like: \"eat\"},{ name: 'James', age: 18,like: \"eat\"}]\n   ```\n\n1. 开辟新的引用地址, 不改变原数组\n\n   ```js\n   let array = [\n     { name: \"Anna\", age: 16 },\n     { name: \"James\", age: 18 }\n   ];\n   let newArray = array.map((item) => {\n     const obj = { ...item, like: \"eat\" };\n     return obj;\n   });\n   console.log(array); // [{ name: 'Anna', age: 16},{ name: 'James', age: 18}]\n   console.log(newArray); //[{ name: 'Anna', age: 16,like: \"eat\"},{ name: 'James', age: 18,like: \"eat\"}]\n   ```\n","slug":"3","published":1,"updated":"2022-01-14T05:57:32.266Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckye3hg4k000ei03l658qb7kv","content":"<p>map 到底改不改变原数组</p>\n<p>一般认为 map 不会对原数组进行修改，但事实并不是如此。</p>\n<h2 id=\"数组内为基础类型数据时-原数组不变\"><a href=\"#数组内为基础类型数据时-原数组不变\" class=\"headerlink\" title=\"数组内为基础类型数据时,原数组不变\"></a>数组内为基础类型数据时,原数组不变</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> array = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>];<br><span class=\"hljs-keyword\">let</span> newArray = array.map(<span class=\"hljs-function\">(<span class=\"hljs-params\">item</span>) =&gt;</span> item * <span class=\"hljs-number\">2</span>);<br><span class=\"hljs-built_in\">console</span>.log(array); <span class=\"hljs-comment\">// [1,2,3,4,5]</span><br><span class=\"hljs-built_in\">console</span>.log(newArray); <span class=\"hljs-comment\">//[2, 4, 6, 8, 10]</span><br></code></pre></div></td></tr></table></figure>\n\n<h2 id=\"数据内是引用类型数据时，注意写法\"><a href=\"#数据内是引用类型数据时，注意写法\" class=\"headerlink\" title=\"数据内是引用类型数据时，注意写法\"></a>数据内是引用类型数据时，注意写法</h2><ol>\n<li><p>item 上直接修改，改变原数组</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> array = [<br>  &#123; <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Anna&quot;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">16</span> &#125;,<br>  &#123; <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;James&quot;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span> &#125;<br>];<br><span class=\"hljs-keyword\">let</span> newArray = array.map(<span class=\"hljs-function\">(<span class=\"hljs-params\">item</span>) =&gt;</span> &#123;<br>  item.like = <span class=\"hljs-string\">&quot;eat&quot;</span>;<br>  <span class=\"hljs-keyword\">return</span> item;<br>&#125;);<br><span class=\"hljs-built_in\">console</span>.log(array); <span class=\"hljs-comment\">// [&#123; name: &#x27;Anna&#x27;, age: 16,like: &quot;eat&quot;&#125;,&#123; name: &#x27;James&#x27;, age: 18,like: &quot;eat&quot;&#125;]</span><br><span class=\"hljs-built_in\">console</span>.log(newArray); <span class=\"hljs-comment\">//[&#123; name: &#x27;Anna&#x27;, age: 16,like: &quot;eat&quot;&#125;,&#123; name: &#x27;James&#x27;, age: 18,like: &quot;eat&quot;&#125;]</span><br></code></pre></div></td></tr></table></figure></li>\n<li><p>开辟新的引用地址, 不改变原数组</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter hljs\"><div class=\"hljs code-wrapper\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></div></td><td class=\"code\"><div class=\"hljs code-wrapper\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> array = [<br>  &#123; <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Anna&quot;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">16</span> &#125;,<br>  &#123; <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;James&quot;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span> &#125;<br>];<br><span class=\"hljs-keyword\">let</span> newArray = array.map(<span class=\"hljs-function\">(<span class=\"hljs-params\">item</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> obj = &#123; ...item, <span class=\"hljs-attr\">like</span>: <span class=\"hljs-string\">&quot;eat&quot;</span> &#125;;<br>  <span class=\"hljs-keyword\">return</span> obj;<br>&#125;);<br><span class=\"hljs-built_in\">console</span>.log(array); <span class=\"hljs-comment\">// [&#123; name: &#x27;Anna&#x27;, age: 16&#125;,&#123; name: &#x27;James&#x27;, age: 18&#125;]</span><br><span class=\"hljs-built_in\">console</span>.log(newArray); <span class=\"hljs-comment\">//[&#123; name: &#x27;Anna&#x27;, age: 16,like: &quot;eat&quot;&#125;,&#123; name: &#x27;James&#x27;, age: 18,like: &quot;eat&quot;&#125;]</span><br></code></pre></div></td></tr></table></figure></li>\n</ol>\n","site":{"data":{}},"wordcount":1189,"excerpt":"","more":"<p>map 到底改不改变原数组</p>\n<p>一般认为 map 不会对原数组进行修改，但事实并不是如此。</p>\n<h2 id=\"数组内为基础类型数据时-原数组不变\"><a href=\"#数组内为基础类型数据时-原数组不变\" class=\"headerlink\" title=\"数组内为基础类型数据时,原数组不变\"></a>数组内为基础类型数据时,原数组不变</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> array = [<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>];<br><span class=\"hljs-keyword\">let</span> newArray = array.map(<span class=\"hljs-function\">(<span class=\"hljs-params\">item</span>) =&gt;</span> item * <span class=\"hljs-number\">2</span>);<br><span class=\"hljs-built_in\">console</span>.log(array); <span class=\"hljs-comment\">// [1,2,3,4,5]</span><br><span class=\"hljs-built_in\">console</span>.log(newArray); <span class=\"hljs-comment\">//[2, 4, 6, 8, 10]</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"数据内是引用类型数据时，注意写法\"><a href=\"#数据内是引用类型数据时，注意写法\" class=\"headerlink\" title=\"数据内是引用类型数据时，注意写法\"></a>数据内是引用类型数据时，注意写法</h2><ol>\n<li><p>item 上直接修改，改变原数组</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> array = [<br>  &#123; <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Anna&quot;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">16</span> &#125;,<br>  &#123; <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;James&quot;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span> &#125;<br>];<br><span class=\"hljs-keyword\">let</span> newArray = array.map(<span class=\"hljs-function\">(<span class=\"hljs-params\">item</span>) =&gt;</span> &#123;<br>  item.like = <span class=\"hljs-string\">&quot;eat&quot;</span>;<br>  <span class=\"hljs-keyword\">return</span> item;<br>&#125;);<br><span class=\"hljs-built_in\">console</span>.log(array); <span class=\"hljs-comment\">// [&#123; name: &#x27;Anna&#x27;, age: 16,like: &quot;eat&quot;&#125;,&#123; name: &#x27;James&#x27;, age: 18,like: &quot;eat&quot;&#125;]</span><br><span class=\"hljs-built_in\">console</span>.log(newArray); <span class=\"hljs-comment\">//[&#123; name: &#x27;Anna&#x27;, age: 16,like: &quot;eat&quot;&#125;,&#123; name: &#x27;James&#x27;, age: 18,like: &quot;eat&quot;&#125;]</span><br></code></pre></td></tr></table></figure></li>\n<li><p>开辟新的引用地址, 不改变原数组</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> array = [<br>  &#123; <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;Anna&quot;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">16</span> &#125;,<br>  &#123; <span class=\"hljs-attr\">name</span>: <span class=\"hljs-string\">&quot;James&quot;</span>, <span class=\"hljs-attr\">age</span>: <span class=\"hljs-number\">18</span> &#125;<br>];<br><span class=\"hljs-keyword\">let</span> newArray = array.map(<span class=\"hljs-function\">(<span class=\"hljs-params\">item</span>) =&gt;</span> &#123;<br>  <span class=\"hljs-keyword\">const</span> obj = &#123; ...item, <span class=\"hljs-attr\">like</span>: <span class=\"hljs-string\">&quot;eat&quot;</span> &#125;;<br>  <span class=\"hljs-keyword\">return</span> obj;<br>&#125;);<br><span class=\"hljs-built_in\">console</span>.log(array); <span class=\"hljs-comment\">// [&#123; name: &#x27;Anna&#x27;, age: 16&#125;,&#123; name: &#x27;James&#x27;, age: 18&#125;]</span><br><span class=\"hljs-built_in\">console</span>.log(newArray); <span class=\"hljs-comment\">//[&#123; name: &#x27;Anna&#x27;, age: 16,like: &quot;eat&quot;&#125;,&#123; name: &#x27;James&#x27;, age: 18,like: &quot;eat&quot;&#125;]</span><br></code></pre></td></tr></table></figure></li>\n</ol>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ckye3hg460001i03lglbjbqu0","category_id":"ckye3hg4a0003i03l8tr7agg0","_id":"ckye3hg4g0008i03l8zq0e9r3"},{"post_id":"ckye3hg490002i03l453cajhf","category_id":"ckye3hg4a0003i03l8tr7agg0","_id":"ckye3hg4h000ai03l2vpk5d5q"},{"post_id":"ckye3hg4j000di03lekrig6x1","category_id":"ckye3hg4a0003i03l8tr7agg0","_id":"ckye3hg4l000ii03lh9370ccb"},{"post_id":"ckye3hg4k000ei03l658qb7kv","category_id":"ckye3hg4k000gi03ld3e21s7e","_id":"ckye3hg4m000ki03l4zaoa5tr"}],"PostTag":[{"post_id":"ckye3hg460001i03lglbjbqu0","tag_id":"ckye3hg4c0004i03l76sqdurz","_id":"ckye3hg4g0007i03lg44f5vii"},{"post_id":"ckye3hg490002i03l453cajhf","tag_id":"ckye3hg4d0006i03l71t9a8s5","_id":"ckye3hg4h000bi03lhd6a2r3o"},{"post_id":"ckye3hg490002i03l453cajhf","tag_id":"ckye3hg4c0004i03l76sqdurz","_id":"ckye3hg4h000ci03lbcs277gk"},{"post_id":"ckye3hg4j000di03lekrig6x1","tag_id":"ckye3hg4c0004i03l76sqdurz","_id":"ckye3hg4k000fi03l29em2qoy"},{"post_id":"ckye3hg4k000ei03l658qb7kv","tag_id":"ckye3hg4k000hi03lfv8z823n","_id":"ckye3hg4l000ji03l5l8i6pdu"}],"Tag":[{"name":"HooK","_id":"ckye3hg4c0004i03l76sqdurz"},{"name":"React","_id":"ckye3hg4d0006i03l71t9a8s5"},{"name":"map","_id":"ckye3hg4k000hi03lfv8z823n"}]}}